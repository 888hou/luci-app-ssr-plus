<%#
 Copyright 2018-2019 Lienol <lawlienol@gmail.com>
 Licensed to the public under the Apache License 2.0.
-%>

<%
local dsp = require "luci.dispatcher"
-%>

<script type="text/javascript">
	//<![CDATA[
	var pings = document.getElementsByClassName('pingtime');
	for(var i = 0; i < pings.length; i++) {
		XHR.get('<%=dsp.build_url("admin/services/shadowsocksr/ping")%>', {
				index: i,
				domain: pings[i].getAttribute("hint")
			},
			function(x, rv) {
			if(x.readyState === 4 ) {
			if(x.status === 200) {try{res = JSON.parse(x.responseText);}catch(e){res=null;}
			if(res !==null && typeof(res) === "object") pings[res.index].innerHTML = "<font color='green'>%s ms</font>".format(res.ping ? res.ping : "--");
			}}});

	}
	//]]>
</script>